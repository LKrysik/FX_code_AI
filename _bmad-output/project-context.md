# FX Agent AI - Project Context

> Generated by BMad Method Document Project Workflow
> Date: 2025-12-18
> Scan Level: Exhaustive

## 1. Project Overview

**Name:** FX Agent AI
**Type:** Multi-part Software Project (Backend + Frontend)
**Field:** Brownfield (existing codebase)
**Domain:** Cryptocurrency Trading Platform

### Philosophy
Building **TOOLS** for traders to create their own strategies, not ready-made solutions.

### Core Capabilities
- Visual strategy builder (no coding required)
- Backtesting on historical data (10x faster simulation)
- Paper trading (virtual positions with real data)
- Live trading (real orders on MEXC Futures)
- Real-time market monitoring
- Pump & dump detection

---

## 2. Technology Stack

### Backend (Python)

| Category | Technology | Status |
|----------|------------|--------|
| Framework | FastAPI | Active |
| Language | Python 3.10+ | Active |
| Architecture | Clean Architecture + DDD | Active |
| Database | QuestDB (time-series) | Active |
| Cache | Redis | Unavailable (Windows/no Docker) |
| Real-time | WebSockets | Active |
| Validation | Pydantic | Active |
| Auth | PyJWT, bcrypt | Active |
| Rate Limiting | slowapi | Active |
| Monitoring | prometheus-client | Active |

**Key Dependencies:** asyncio, aiohttp, websockets, pandas, numpy

### Frontend (Next.js)

| Category | Technology | Status |
|----------|------------|--------|
| Framework | Next.js 14 (App Router) | Active |
| Language | TypeScript | Active |
| UI Library | MUI (Material-UI) v5 | Active |
| State Management | Zustand | Active |
| Canvas/Flow | ReactFlow 11.10+ | Active |
| Charts | Recharts, uPlot, Lightweight Charts | Active |
| Real-time | Socket.io-client | Active |
| Testing | Jest, Testing Library, Playwright | Active |

---

## 3. Architecture

### Backend Structure (src/)

```
src/
├── api/                    # REST/WebSocket endpoints
│   ├── websocket/          # WebSocket handlers
│   ├── trading_routes.py   # Live trading API
│   ├── paper_trading_routes.py
│   ├── dashboard_routes.py
│   ├── signals_routes.py
│   ├── indicators_routes.py
│   └── unified_server.py   # Main FastAPI app
├── application/            # Use cases, orchestrators
│   ├── orchestrators/
│   └── services/
├── domain/                 # Pure business logic
│   ├── models/             # Data models (Order, Position, Trade, Portfolio)
│   ├── services/           # Domain services
│   │   ├── indicators/     # 22+ custom indicators
│   │   └── pump_detector.py
│   └── interfaces/         # Abstract interfaces
├── infrastructure/         # External adapters
│   ├── config/
│   ├── exchanges/          # MEXC adapter
│   └── factories/
├── trading/                # Trading execution
├── exchanges/              # Exchange base classes
├── monitoring/             # Metrics and health
└── core/                   # Shared utilities
```

### Frontend Structure (frontend/)

```
frontend/
├── src/
│   ├── app/                # Next.js App Router pages
│   │   ├── dashboard/
│   │   ├── trading/
│   │   ├── paper/
│   │   ├── backtesting/
│   │   ├── strategy-builder/
│   │   ├── indicators/
│   │   └── session-history/
│   ├── components/         # React components (85+)
│   │   ├── strategy/       # Strategy builder
│   │   ├── canvas/         # ReactFlow nodes
│   │   ├── charts/         # Chart components
│   │   ├── dashboard/      # Dashboard widgets
│   │   ├── trading/        # Trading UI
│   │   └── indicators/     # Indicator management
│   ├── stores/             # Zustand state stores
│   │   ├── tradingStore.ts
│   │   ├── dashboardStore.ts
│   │   ├── websocketStore.ts
│   │   └── authStore.ts
│   ├── services/           # API services
│   └── hooks/              # Custom React hooks
```

---

## 4. API Endpoints

### REST API Routes

| Route | Method | Description |
|-------|--------|-------------|
| `/api/trading/positions` | GET | Query live positions |
| `/api/trading/positions/{id}/close` | POST | Close a position |
| `/api/trading/positions/{id}/sl-tp` | PATCH | Modify SL/TP |
| `/api/trading/orders` | GET | Query live orders |
| `/api/trading/orders/{id}/cancel` | POST | Cancel an order |
| `/api/trading/performance/{session}` | GET | Get session performance |
| `/api/paper/*` | * | Paper trading operations |
| `/api/dashboard/*` | * | Dashboard data |
| `/api/signals/*` | * | Signal history |
| `/api/indicators/*` | * | Indicator management |
| `/api/strategies/*` | * | Strategy CRUD |

### WebSocket API

- Real-time market data streaming
- Position updates
- Signal notifications
- State machine transitions
- Subscription management

---

## 5. Domain Models

### Core Trading Models

**Order**
- order_id, symbol, exchange
- side (BUY/SELL), order_type (MARKET/LIMIT/STOP_LOSS/TAKE_PROFIT)
- quantity, price, status
- filled_quantity, average_fill_price, fee

**Position**
- position_id, symbol, exchange
- side, size, entry_price, leverage
- status (OPEN/CLOSED/CLOSING)
- stop_loss_price, take_profit_price
- unrealized_pnl, realized_pnl, max_profit, max_drawdown

**Trade**
- trade_id, symbol, exchange
- entry_price, exit_price, pnl, pnl_percentage
- entry_time, exit_time, exit_reason

**Portfolio**
- total_balance_usdt, available_balance_usdt
- used_margin_usdt, open_positions
- total_unrealized_pnl, total_realized_pnl

### Signal Models

**FlashPumpSignal**
- symbol, exchange, detection_time
- peak_price, baseline_price, pump_magnitude
- volume_surge_ratio, price_velocity
- confidence_score

---

## 6. Custom Indicators (22+)

| Indicator | Purpose |
|-----------|---------|
| pump_magnitude_pct | Pump size measurement |
| price_velocity | Price change speed |
| volume_surge_ratio | Volume spike detection |
| bid_ask_imbalance | Order book imbalance |
| liquidity_drain_index | Liquidity analysis |
| momentum_reversal_index | Momentum shift detection |
| dump_exhaustion_score | Dump ending detection |
| velocity_cascade | Cascading velocity |
| velocity_stabilization_index | Velocity settling |
| support_level_proximity | Support level distance |
| twpa | Time-weighted price average |
| twpa_ratio | TWPA comparison |
| rsi | Relative Strength Index |
| spread_pct | Bid-ask spread |
| unrealized_pnl_pct | Position P&L |
| price_momentum | Price momentum |

---

## 7. Frontend Pages

| Route | Purpose |
|-------|---------|
| `/` | Home/Login |
| `/dashboard` | Main dashboard |
| `/trading` | Live trading |
| `/paper` | Paper trading |
| `/backtesting` | Backtest strategies |
| `/strategy-builder` | Visual strategy builder |
| `/strategies` | Strategy management |
| `/indicators` | Indicator configuration |
| `/market-data` | Market data view |
| `/market-scanner` | Market scanner |
| `/data-collection` | Data collection sessions |
| `/session-history` | Trading history |
| `/risk-management` | Risk controls |
| `/settings` | Application settings |

---

## 8. Key Components

### Strategy Builder
- **StrategyBuilder5Section.tsx** - 5-section condition system (S1→O1→Z1→ZE1→E1)
- **ConditionBlock.tsx** - Individual condition configuration
- **ConditionGroup.tsx** - Condition grouping with logic operators
- **StateMachineDiagram.tsx** - Visual state machine

### Canvas Nodes (ReactFlow)
- **ActionNode** - Trading actions
- **ConditionNode** - Condition evaluation
- **DataSourceNode** - Data inputs
- **IndicatorNode** - Indicator selection

### Dashboard Widgets
- **LiveIndicatorPanel** - Real-time indicators
- **SignalDetailPanel** - Signal details
- **TransactionHistoryPanel** - Recent transactions
- **CandlestickChart** - Price chart
- **PositionMonitor** - Active positions
- **ActivePositionBanner** - Position status

### Charts
- **CandlestickChart** - OHLCV data (Lightweight Charts)
- **EquityCurveChart** - Portfolio value over time
- **DrawdownChart** - Drawdown visualization
- **MiniSparkline** - Compact trend lines
- **UPlotChart** - High-performance charts

---

## 9. Testing

### Backend Tests (596 tests)
- Unit tests
- Integration tests
- E2E tests
- API tests

### Frontend Tests
- Jest + Testing Library (unit/integration)
- Playwright (E2E)
- Cypress (E2E)

---

## 10. Known Issues & Constraints

### Critical Issues (User Reported)
1. **Trading not working** - Neither live nor backtesting functions properly
2. **UI broken** - Large parts of the interface don't work
3. **Strategy Builder incomplete** - Both frontend and backend may be faulty
4. **Lack of E2E tests** - No process-level testing for critical flows

### Technical Constraints
1. **Redis unavailable** - Windows without Docker, state persistence degraded
2. **MEXC only** - Single exchange support

### Technical Debt
- Potential circular import issues in unified_server.py
- Some components have .example.tsx and .integration.tsx files (testing patterns)
- Large archive of historical docs in docs/_archive/

---

## 11. Documentation Inventory

### Active Documentation (docs/)

| Category | Files | Key Documents |
|----------|-------|---------------|
| API | 5 | WEBSOCKET.md, CHANGELOG.md |
| Architecture | 4 | DECISIONS.md, CONTAINER.md |
| Database | 4 | SCHEMA.md, QUESTDB.md |
| Development | 10+ | CODING_STANDARDS.md, ERROR_HANDLING.md |
| Frontend | 8 | USER_INTERFACE_GUIDE.md, STRATEGY_BUILDER_USER_GUIDE.md |
| Trading | 5 | INDICATORS.md, STRATEGIES.md |
| Roadmap | 1 | ROADMAP.md |

### Archive
- 50+ historical documents in docs/_archive/
- Analysis reports, bugfixes, refactoring plans

---

## 12. Development Notes

### Environment
- Windows (no Docker)
- Python virtual environment (.venv/)
- Node.js for frontend

### Running the Project
- Backend: `python -m src.api.unified_server`
- Frontend: `npm run dev` (from frontend/)
- Database: QuestDB (must be running)

### Key Files
- Backend entry: `src/api/unified_server.py`
- Frontend entry: `frontend/src/app/page.tsx`
- Config: `config/`, `.env` files
- Dependencies: `requirements.txt`, `frontend/package.json`
